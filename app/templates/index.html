{% extends "base.html" %}

{% block content %}
    <!-- **************************************************************** 
        github: https://github.com/tetsuya-okada3620/study_app
        **************************************************************** -->
    <div class="bg-success px-3 py-3 rounded" style="color: white;">
        <h1 class="mb-3">学習管理Web <span class="fs-6">サイト作成: 岡田 徹也</span></h1>
        
        <div class="mb-1">
            {% if username %}
                
                ※{{ username }}でログイン中です。
                <form method="GET" action="{{ url_for('main.input_record') }}" style="display: inline-block; margin-right: 10px;">
                    <button type="submit" class="btn btn-info", style="color: white;">新規入力</button>
                </form>
                <form method="POST" action="{{ url_for('main.logout') }}" style="display: inline-block;">
                    <button type="submit" class="btn btn-info", style="color: white;">ログアウト</button>
                </form>
            {% endif %}
            <form method="POST" action="{{ url_for('main.foot') }}">
                {{ foot.hidden_tag() }}
                {{ foot.submit(class="btn btn-primary py-0", style="color: white;") }}
                ← 押してもらえると<span style="font-size: 10px"> (誰かに見られていというプレッシャーで) </span>励みになります。個人情報等は登録されません。
            </form>
        </div>

        <div class="container-fluid mb-3">
            <form method="POST" action="{{ url_for('main.index') }}">
                {{ search.hidden_tag() }}
                <div class="row g-2">
                    <div class="col-4">
                        {{ search.category_name.label(class="form-label m-0") }}
                        {{ search.category_name(class="form-control") }}
                    </div>
                    <div class="col-auto">
                        {{ search.study_date_start.label(class="form-label m-0") }}
                        {{ search.study_date_start(class="form-control") }}
                    </div>
                    <div class="col-auto">
                        {{ search.study_date_end.label(class="form-label m-0") }}
                        {{ search.study_date_end(class="form-control") }}
                    </div>
                    <div class="col-auto">
                        {{ search.submit(class="btn btn-info mt-4", style="color: white;") }}
                    </div>
                </div>
            </form>
        </div>
        <div class="bg-danger" style="width: auto;">
            {% with messages = get_flashed_messages() %}
                {% if messages %}{{ messages[-1] }}{% endif %}
            {% endwith %}
        </div>
    </div>

    <div class="mb-3 table-responsive border p-2" style="max-height: 400px; overflow-y: auto;">
        <table class="table table-hover text-start" style="width: auto;">
            <thead>
                <tr>
                    <th>カテゴリ</th>
                    <th>開始日時</th>
                    <th>終了日時</th>
                    <th>内容</th>
                    <th>備考</th>
                    <th>入力者</th>
                    <th>編集</th>
                </tr>
            </thead>
            <tbody class="table-group-divider">
                {% if records %}
                    {% for rec in records: %}
                        <tr>
                            <td>{{ rec.categories.category_name }}</td>
                            <td>{{ rec.study_date_start }}</td>
                            <td>{{ rec.study_date_end }}</td>
                            <td style="max-width: 700px; white-space: pre-wrap; word-break: break-word;">{{ rec.confirm }}</td>
                            <td>{{ rec.remark }}</td>
                            <td>{{ rec.users.name }}</td>
                            {% if username and user_id == rec.user_id %}
                            <td><a href="{{ url_for('main.input_record', id=rec.id) }}">編集</a></td>
                            {% else %}
                            <td></td>
                            {% endif %}
                        </tr>
                    {% endfor %}
                {% endif %}
            </tbody>
        </table>
    </div>

    <div class="border px-2 py-2">
        <div class="mb-3">
            <h4>〇入力者向けログイン <span class="fs-6">(入力フォーム閲覧用 ユーザー名:guest パスワード:guest)</span></h4>
            <form method="POST" action="{{ url_for('main.login') }}">
                {{ login.hidden_tag() }}
                <div class="row g-3 align-items-end" style="max-width: 700px;">
                <div class="col-auto">
                    {{ login.username.label(class="form-label") }}
                    {{ login.username(class="form-control") }}
                </div>
                <div class="col-auto">
                    {{ login.password.label(class="form-label") }}
                    {{ login.password(class="form-control") }}
                </div>
                <div class="col-auto">
                    {{ login.submit(class="btn btn-info", style="color: white;") }}
                </div>
                </div>
            </form>
        </div>
        <div class="mb-3">
            <h5>〇サイト作成の残課題</h5>
            <ul class="">
                <li>時間の差分も抽出したい</li>
                <li>検索結果をplotlyでグラフ描画する</li>
                <li style="color: red">データの削除ボタンが無い(マスト)</li>
            </ul>
        </div>
    </div>
{% endblock %}